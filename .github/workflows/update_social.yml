name: Update Social Profiles
on:
  schedule:
    - cron: '0 */3 * * *'  # –ö–∞–∂–¥—ã–µ 3 —á–∞—Å–∞
  workflow_dispatch:  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
  push:
    branches: [ main ]
    paths:
      - 'scripts/social/**'
      - 'data/actions_config.json'
      - 'data/modifiers_config.json'

jobs:
  update-profiles:
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• Checkout repository
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
    
    - name: üêç Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: üì¶ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4 lxml
    
    - name: üîÑ Update social profiles
      run: |
        echo "üîÑ –ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π..."
        cd scripts
        python update_social_profiles.py
        echo "‚úÖ –ü—Ä–æ—Ñ–∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!"
    
    - name: üíæ Commit changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        if git diff --quiet; then
          echo "‚ÑπÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç"
        else
          git add data/players/social_profile_*.json
          git add data/social_history/*
          git commit -m "ü§ù –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π [skip ci]"
          git push
          echo "‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø—É—à–µ–Ω—ã"
        fi
    
    - name: üìä Generate report
      run: |
        echo "üìà –û—Ç—á—ë—Ç –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:"
        echo "=========================="
        ls -la data/players/social_profile_*.json | wc -l | xargs echo "–û–±–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–æ—Ñ–∏–ª–µ–π:"
        echo "=========================="
    
    - name: üö® Notify on failure
      if: failure()
      run: |
        echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π"
        echo "–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –≤—ã—à–µ"
