name: Daily Player Update

on:
  schedule:
    - cron: '0 3 * * *'  # –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 03:00 UTC
  workflow_dispatch:      # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write    # –ö–ª—é—á–µ–≤–æ–µ –ø—Ä–∞–≤–æ!

    steps:
    # 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å —Ç–æ–∫–µ–Ω–æ–º
    - name: üì• Checkout code
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    # 2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Python
    - name: üêç Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    # 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    - name: üì¶ Install dependencies
      run: |
        pip install requests beautifulsoup4

    # 4. –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç (–¢–û–õ–¨–ö–û –µ—Å–ª–∏ userlist_parser.py –∏—Å–ø—Ä–∞–≤–ª–µ–Ω!)
    - name: üéÆ Run game update
      run: |
        cd scripts
        python core_parser.py

    # 5. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Git –∏ –ø—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    - name: üíæ Commit & Push
      run: |
        git config --global user.name "GitHub Actions Bot"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        
        # –î–æ–±–∞–≤–ª—è–µ–º –í–°–ï –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        git add data/ players_data.json
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∫–æ–º–º–∏—Ç–∞
        if git diff --staged --quiet; then
          echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞."
        else
          git commit -m "ü§ñ –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö $(date '+%Y-%m-%d %H:%M')"
          git push origin HEAD:main
        fi
